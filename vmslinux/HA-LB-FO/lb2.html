<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>lb2</title>
    <meta name="author" content="PCo-2016/2022">
    <meta name="description" content="linux, VM">
    <style>
        
        body { font-family: system-ui; }
        img { border: 1px silver solid; padding: 10px; }
        em { border-radius: .3em; padding: .0em .2em; background-color: lightblue; }
        strong { color: red; }
        pre { background-color: lemonchiffon; color: navy; border-radius: .3em; padding: .2em; }      
        details > summary { padding: 4px; background-color: #eee; border: none;
            box-shadow: 1px 1px 2px #bbb; cursor: pointer; margin-top: 0.5em; }

    </style>
  </head>
  <body>
    <h1>[ HA-LB-FO ] :: lb2</h1>
    <p><img src="HA-LB-FO.png" alt="schema"></p>
    
    
        <details>
            <summary><em>nano</em> /etc/hostname</summary>
            <pre>
lb2</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/hosts</summary>
            <pre>
127.0.0.1	localhost
127.0.1.1	lb2
192.168.56.11	lb1
192.168.56.12	lb2
192.168.200.11	web1
192.168.200.12	web2
192.168.200.13	web3

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters</pre>
        </details>

        <details>
            <summary><em>cmd bash</em> install_ipvsadm_heartbeat.sh</summary>
            <pre>
#!/bin/sh
apt update
apt -y install ipvsadm
apt -y install heartbeat
# activation routage
sed -i &#x27;s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/&#x27; /etc/sysctl.conf</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/ipvsadm.rules</summary>
            <pre>
ipvsadm -A -t 192.168.56.10:80 -s rr
ipvsadm -a -t 192.168.56.10:80 -r 192.168.200.11:80 -m
ipvsadm -a -t 192.168.56.10:80 -r 192.168.200.12:80 -m
ipvsadm -a -t 192.168.56.10:80 -r 192.168.200.13:80 -m</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/default/ipvsadm</summary>
            <pre>
# ipvsadm
# if you want to start ipvsadm on boot set this to true
AUTO=&quot;true&quot;
# daemon method (none|master|backup)
DAEMON=&quot;master&quot;
# use interface (eth0,eth1...)
IFACE=&quot;enp0s3&quot;</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/ha.d/ha.cf</summary>
            <pre>
bcast enp0s3
deadtime 5
keepalive 1
node lb1 lb2</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/ha.d/haresources</summary>
            <pre>
#adresses virtuelles (et flottantes)
lb1	IPaddr::192.168.56.10	ipvsadm
lb1	IPaddr::192.168.200.254</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/ha.d/authkeys</summary>
            <pre>
auth 1
1 md5 motdepasse</pre>
        </details>

        <details>
            <summary><em>cmd bash</em> chmod_authkeys.sh</summary>
            <pre>
#!/bin/sh
chmod 600 /etc/ha.d/authkeys</pre>
        </details>

        <details>
            <summary><em>nano</em> /etc/network/interfaces</summary>
            <pre>
# localhost
auto lo
iface lo inet loopback

# réseau privé hôte &gt; 192.168.56.0/24
allow-hotplug enp0s3
iface enp0s3 inet static
	address 192.168.56.12/24

# réseau interne &#x27;R200&#x27; &gt; 192.168.200.0/24
allow-hotplug enp0s8
iface enp0s8 inet static
	address 192.168.200.252/24

# <strong>✋  valider la configuration &quot;Réseau&quot; sous VirtualBox, puis redémarrer…</strong></pre>
        </details>

  </body>
</html>
