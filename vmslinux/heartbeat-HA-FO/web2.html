<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>heartbeat-HA-FO/web2</title>
    <meta name="author" content="PCo-2016/2019">
    <meta name="description" content="SISR">
    <meta name="highlight" content="true">
    <meta name="pasnumero" content="false">
    <link rel="icon" href="http://cp.cosson.free.fr/pco-css-js/favicon.ico">
    <link rel="stylesheet" type="text/css" href="http://cp.cosson.free.fr/pco-css-js/cours.css">
    <script language="javascript" src="http://cp.cosson.free.fr/pco-css-js/dev_red_hx.js"></script>
	<style>
		i {color: mediumaquamarine;}
		pre {tab-size: 4;-moz-tab-size: 4;}
		b .hljs-comment {color: red;}
	</style>
  </head>
  <body>
      
        <p>
          <img class="fixe" src="heartbeat-HA-FO.png" alt="schéma heartbeat-HA-FO">
        </p>


    <h1><i>$ nano</i> /etc/hostname</h1>

    <pre><code class="bash">web2
</code></pre>

    <h1><i>$ nano</i> /etc/hosts</h1>

    <pre><code class="bash">127.0.0.1		localhost
127.0.1.1		web2
192.168.56.11	web1

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</code></pre>

    <h1><i>$ nano</i> /etc/network/interfaces</h1>

    <pre><code class="bash"># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

# privé hôte 192.168.56.0/24
auto enp0s3
iface enp0s3 inet static
	address 192.168.56.12/24
	gateway 192.168.56.254
	
# <b><strong>✋</strong> valider la configuration "Réseau" sous VirtualBox, puis redémarrer…</b>
</code></pre>

    <h1><i>$ bash</i> install_paquets_apache_heartbeat</h1>

    <pre><code class="bash">apt update
apt install -y apache2
apt install -y heartbeat
</code></pre>

    <h1><i>$ nano</i> /etc/ha.d/ha.cf</h1>

    <pre><code class="bash">bcast enp0s3
deadtime 5
keepalive 1
node web1 web2
auto_failback on
</code></pre>

    <h1><i>$ nano</i> /etc/ha.d/haresources</h1>

    <pre><code class="bash">web1	IPaddr::192.168.56.10	apache2
</code></pre>

    <h1><i>$ nano</i> /etc/ha.d/authkeys</h1>

    <pre><code class="bash">auth 1
1 md5 motdepasse
</code></pre>

    <h1><i>$ bash</i> configuration_heartbeat_apache</h1>

    <pre><code class="bash">chmod 600 /etc/ha.d/authkeys
systemctl stop apache2.service
systemctl disable apache2.service

# manuellement avec nano /var/www/html/index.html ou direct avec sed ...
sed -i &#x27;s/Apache2 Debian Default Page/Serveur ACTIF WEB2/&#x27; /var/www/html/index.html

systemctl restart heartbeat.service
systemctl status heartbeat.service</code></pre>

    </body>
</html>